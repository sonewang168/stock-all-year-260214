<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>âš”ï¸ å°è‚¡ä½œæˆ°è¨ˆç•« 2026-2027</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš”ï¸</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0a0f1a;--bg2:#0d1929;--cyan:#64ffda;--cyan2:#00bcd4;--green:#00e676;--red:#ff5252;--orange:#ff8c00;--gold:#ffd700;--blue:#1e88e5;--purple:#bb86fc;--txt:#e0e6ed;--sub:#5a7a9a;--sub2:#4a6a8a;--sub3:#8ab4d6;--sub4:#3a5a7a;--border:rgba(100,255,218,0.08);--border2:rgba(100,255,218,0.15);--card:rgba(13,25,41,0.6);--card2:rgba(13,25,41,0.3);--mono:'JetBrains Mono',monospace;--sans:'Noto Sans TC','Segoe UI',sans-serif}
html,body{height:100%;font-family:var(--sans);background:linear-gradient(135deg,var(--bg) 0%,var(--bg2) 50%,#0a1628 100%);color:var(--txt)}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#1e3a5f;border-radius:3px}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes barGrow{from{width:0}}
.fade{animation:fadeIn .3s ease-out}
.card{border-radius:12px;border:1px solid var(--border);background:var(--card);overflow:hidden;margin-bottom:14px}
.card-head{padding:10px 16px;background:rgba(100,255,218,.04);border-bottom:1px solid rgba(100,255,218,.06)}
.card-head h3{font-size:13px;font-weight:700;color:var(--sub3)}
.task-row{display:flex;align-items:flex-start;gap:10px;padding:9px 16px;border-bottom:1px solid rgba(100,255,218,.04);transition:background .15s}
.task-row:hover{background:rgba(100,255,218,.03)}
.chk{width:20px;height:20px;min-width:20px;border-radius:4px;border:2px solid #2a4a6a;background:transparent;cursor:pointer;display:flex;justify-content:center;align-items:center;margin-top:1px;transition:all .2s;flex-shrink:0}
.chk.done{border-color:var(--green);background:rgba(0,230,118,.15)}
.chk.red{border-color:#5a3333}.chk.red.done{border-color:var(--red);background:rgba(231,76,60,.15)}
.btn{padding:6px 14px;border-radius:7px;font-size:12px;cursor:pointer;font-weight:600;border:1px solid transparent;transition:all .2s;font-family:var(--sans)}
.btn:hover{transform:translateY(-1px)}
.btn-p{background:linear-gradient(135deg,rgba(100,255,218,.2),rgba(0,188,212,.2));border-color:rgba(100,255,218,.3);color:var(--cyan)}
.btn-p:hover{box-shadow:0 0 20px rgba(100,255,218,.15)}
.btn-d{background:transparent;border-color:rgba(231,76,60,.3);color:var(--red);font-size:11px;padding:4px 10px}
.btn-s{background:transparent;border-color:var(--border2);color:var(--sub);font-size:11px;padding:4px 10px}
.btn-g{background:linear-gradient(135deg,rgba(255,215,0,.15),rgba(255,140,0,.1));border-color:rgba(255,215,0,.3);color:var(--gold)}
.btn-v{background:linear-gradient(135deg,rgba(187,134,252,.15),rgba(100,255,218,.1));border-color:rgba(187,134,252,.3);color:var(--purple)}
.inp{background:rgba(100,255,218,.06);border:1px solid var(--border2);color:var(--txt);padding:7px 10px;border-radius:6px;font-size:13px;outline:none;font-family:var(--mono);width:100%}
.inp:focus{border-color:var(--cyan);box-shadow:0 0 0 2px rgba(100,255,218,.1)}
select.inp{cursor:pointer;font-family:var(--sans)}
textarea.inp{font-family:var(--sans);resize:vertical}
.tab{padding:5px 12px;border-radius:6px;font-size:12px;cursor:pointer;border:1px solid transparent;transition:all .2s;background:transparent;color:var(--sub);font-family:var(--sans)}
.tab.on{background:rgba(100,255,218,.15);border-color:rgba(100,255,218,.3);color:var(--cyan);font-weight:700}
.mtab{padding:5px 8px;border-radius:8px;display:inline-flex;align-items:center;gap:4px;cursor:pointer;border:1px solid rgba(100,255,218,.06);transition:all .2s;font-size:11px}
.mtab:hover{background:rgba(100,255,218,.1)}
.mtab.on{background:rgba(100,255,218,.12);border-color:rgba(100,255,218,.25)}
.mtab.half{border-color:rgba(255,215,0,.3);background:rgba(255,215,0,.08)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.gridf{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px}
.flex{display:flex}.gap4{gap:4px}.gap6{gap:6px}.gap8{gap:8px}.gap10{gap:10px}.gap12{gap:12px}
.wrap{flex-wrap:wrap}.center{align-items:center}.between{justify-content:space-between}
.mono{font-family:var(--mono)}.bold{font-weight:700}.f10{font-size:10px}.f11{font-size:11px}.f12{font-size:12px}.f13{font-size:13px}.f14{font-size:14px}.f16{font-size:16px}
.sell-tag{background:rgba(255,215,0,.15);color:var(--gold);padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700}
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(80px);background:rgba(0,0,0,.9);color:var(--cyan);padding:10px 24px;border-radius:10px;font-size:13px;font-weight:600;z-index:999;transition:transform .3s;border:1px solid rgba(100,255,218,.2);pointer-events:none}
.toast.show{transform:translateX(-50%) translateY(0)}
@media(max-width:600px){.grid2,.grid3{grid-template-columns:1fr}.gridf{grid-template-columns:1fr 1fr}.mtab{padding:4px 6px;font-size:10px}}
</style>
</head>
<body>
<div id="toast" class="toast"></div>
<div style="padding:20px 16px 12px;border-bottom:1px solid var(--border);background:rgba(10,15,26,.92);backdrop-filter:blur(12px);position:sticky;top:0;z-index:10">
<div style="max-width:960px;margin:0 auto">
  <div class="flex between center" style="margin-bottom:8px">
    <div>
      <h1 style="font-size:19px;font-weight:900;background:linear-gradient(135deg,#64ffda,#00bcd4,#ff8c00);-webkit-background-clip:text;-webkit-text-fill-color:transparent">âš”ï¸ å°è‚¡ä½œæˆ°è¨ˆç•« 2026-2027</h1>
      <p style="color:var(--sub);font-size:11px" id="headerSub"></p>
    </div>
    <button class="btn btn-d" onclick="if(confirm('é‡ç½®æ‰€æœ‰ï¼Ÿ')){D={tasks:{},principles:{},holdings:JSON.parse(JSON.stringify(DH)),wr:[],ms:[],pt:[]};sv();render();toast('ğŸ”„ å·²é‡ç½®')}">é‡ç½®</button>
  </div>
  <div class="flex center gap10" style="margin-bottom:8px">
    <div style="flex:1;height:6px;background:rgba(100,255,218,.08);border-radius:4px;overflow:hidden"><div id="tBar" style="height:100%;border-radius:4px;background:linear-gradient(90deg,#1e88e5,#64ffda);transition:width .5s;animation:barGrow .8s ease-out"></div></div>
    <span id="tTxt" class="mono bold" style="color:var(--cyan);font-size:12px"></span>
  </div>
  <div class="flex gap4 wrap" id="vTabs" style="margin-bottom:6px"></div>
  <div class="flex gap4 wrap" id="mTabs"></div>
</div></div>
<div id="C" style="max-width:960px;margin:0 auto;padding:14px 16px 80px"></div>
<script>
// === DATA ===
const DH=[
  {id:'h1',name:'å•Ÿç¢',code:'6285',shares:2,unit:'å¼µ',cost:177.25,target:'195',strat:'ä½è»Œè¡›æ˜Ÿæ ¸å¿ƒ'},
  {id:'h2',name:'è¯é€š',code:'2313',shares:1,unit:'å¼µ',cost:177,target:'210',strat:'è¡›æ˜Ÿæ¿é¾é ­'},
  {id:'h3',name:'å—äºç§‘',code:'2408',shares:1,unit:'å¼µ',cost:310,target:'348',strat:'DRAMè¶…å¾ªç’°'},
  {id:'h4',name:'æ—ºå®',code:'2337',shares:1,unit:'å¼µ',cost:89.4,target:'121',strat:'åœåˆ©115-120'},
  {id:'h5',name:'è¯é‚¦é›»',code:'2344',shares:2,unit:'å¼µ',cost:116.5,target:'155',strat:'ä¸Šæª”æœ€å¤§'},
  {id:'h6',name:'å°ç£50',code:'0050',shares:1,unit:'å¼µ',cost:74.1,target:'å¤§ç›¤',strat:'æ°¸é ä¸è³£'},
  {id:'h7',name:'é«˜è‚¡æ¯',code:'0056',shares:1,unit:'å¼µ',cost:38.04,target:'é…æ¯',strat:'æ°¸é ä¸è³£'},
  {id:'h8',name:'é‘«ç§‘',code:'3663',shares:2,unit:'å¼µ',cost:69,target:'78',strat:'è§€å¯Ÿ3å€‹æœˆ'},
];
const PR=[
  {id:'p1',t:'ä¸è¿½æ¼²åœï¼Œç­‰æ‹‰å›å†æ¥'},{id:'p2',t:'ä¸åœ¨è™§æç‹€æ…‹ä¸‹æ›è‚¡'},{id:'p3',t:'æ¯æœˆæ›è‚¡â‰¤1æ¬¡'},
  {id:'p4',t:'å®šå­˜ä¸å‹•ï¼Œé™¤éå´©ç›¤åŠ ç¢¼'},{id:'p5',t:'çœ‹ç›¤ï¼šæ¯é€±1-2æ¬¡'},{id:'p6',t:'ç”¨è³ºåˆ°çš„éŒ¢é–‹æ–°å€‰'},
];
const MO=[
  {id:'m1',n:1,r:'2/12ï½3/11',t:'ä¼‘æ¯ï¼‹è§€å¯Ÿ',ic:'ğŸŒ™',h:1,sec:[{st:'ğŸ“… æ˜¥ç¯€ï¼‹é–‹ç´…ç›¤',tk:[{id:'m1t1',t:'è¿½è¹¤ç¾å…‰/è¼é”/SpaceX/é—œç¨…/éŸ“è‚¡',n:'ä¼‘å¸‚åŠŸèª²'},{id:'m1t2',t:'é–‹ç´…ç›¤å‰ä¸‰å¤©ä¸äº¤æ˜“',n:'æœ€é‡è¦ï¼'},{id:'m1t3',t:'è¨˜éŒ„é–‹ç›¤è¡¨ç¾èˆ‡æ³•äººå‹•å‘',n:''},{id:'m1t4',t:'é¦–é€±äº¤æ˜“å¾Œç¶œåˆè©•ä¼°',n:''},{id:'m1t5',t:'æœˆå­˜2-3è¬å…¥å¸³æˆ¶',n:''}]}]},
  {id:'m2',n:2,r:'3/12ï½4/11',t:'è²¡å ±é©—è­‰',ic:'ğŸ“Š',h:1,sec:[{st:'ğŸ” Q1è²¡å ±',tk:[{id:'m2t1',t:'è¯é‚¦é›»EPS>3å…ƒï¼Ÿ',n:'è¶…éâ†’130-140'},{id:'m2t2',t:'å—äºç§‘Q1ç‡Ÿæ”¶é©—è­‰',n:''},{id:'m2t3',t:'å•Ÿç¢Q1ç‡Ÿæ”¶ç™¾å„„+',n:''},{id:'m2t4',t:'é‘«ç§‘3å€‹æœˆé©—è­‰',n:''},{id:'m2t5',t:'æ—ºå®åœåˆ©æ±ºç­–115-120',n:''}]}]},
  {id:'m3',n:3,r:'4/12ï½5/11',t:'åŸ·è¡ŒæœŸ',ic:'âš¡',h:1,sec:[{st:'ğŸ“‹ åŸ·è¡Œèª¿æ•´',tk:[{id:'m3t1',t:'è²¡å ±å¥½â†’ä¸å‹•',n:''},{id:'m3t2',t:'æ—ºå®åœåˆ©â†’ä½ˆå±€æ–°æ¨™çš„',n:''},{id:'m3t3',t:'é‘«ç§‘ç„¡æ”¹å–„â†’è€ƒæ…®æ±°æ›',n:'å”¯ä¸€å…è¨±æ›è‚¡'}]}]},
  {id:'m4',n:4,r:'5/12ï½6/11',t:'é…æ¯å†æŠ•å…¥',ic:'ğŸ’µ',h:1,sec:[{st:'ğŸ“¥ é…æ¯',tk:[{id:'m4t1',t:'æ”¶å–0050/0056/å…¶ä»–é…æ¯',n:''},{id:'m4t2',t:'é…æ¯æŠ•å…¥é›¶è‚¡',n:''},{id:'m4t3',t:'è©•ä¼°è¡›æ˜Ÿçˆ†ç™¼é€²åº¦',n:''}]}]},
  {id:'m5',n:5,r:'6/12ï½7/11',t:'ä¸­æœŸæª¢è¦–',ic:'ğŸ”',h:1,sec:[{st:'ğŸ“‹ åŠå¹´æª¢',tk:[{id:'m5t1',t:'è¨ˆç®—å‰6å€‹æœˆç¸½å ±é…¬',n:''},{id:'m5t2',t:'æ¯”è¼ƒï¼šè¨˜æ†¶é«”vsè¡›æ˜ŸvsPCB',n:''},{id:'m5t3',t:'è¯é‚¦é›»140+â†’è³£1å¼µ',n:''}]}]},
  {id:'m6',n:6,r:'7/12ï½8/11',t:'ğŸ† H1çµç®—',ic:'ğŸ†',h:1,isSt:1,sec:[{st:'ğŸ“Š ä¸ŠåŠå¹´çµç®—',tk:[{id:'m6t1',t:'å®ŒæˆH1åŠå¹´è‡ªå‹•çµç®—',n:''},{id:'m6t2',t:'åŒ¯å‡ºH1å ±è¡¨çµ¦Claude',n:''},{id:'m6t3',t:'åˆ¶å®šä¸‹åŠå¹´ç­–ç•¥',n:''}]}]},
  {id:'m7',n:7,r:'8/12ï½9/11',t:'H2å•Ÿå‹•',ic:'ğŸš€',h:2,sec:[{st:'ğŸ“‹ H2é–‹å±€',tk:[{id:'m7t1',t:'ä¾H1çµè«–èª¿æ•´æŒè‚¡',n:''},{id:'m7t2',t:'æª¢è¦–Q2è²¡å ±',n:''},{id:'m7t3',t:'è©•ä¼°åŠ ç¢¼/æ¸›ç¢¼',n:''}]}]},
  {id:'m8',n:8,r:'9/12ï½10/11',t:'Q3ä½ˆå±€',ic:'ğŸ“ˆ',h:2,sec:[{st:'ğŸ“‹ ç§‹å­£ä½ˆå±€',tk:[{id:'m8t1',t:'è˜‹æœæ–°æ©Ÿæ•ˆæ‡‰è¿½è¹¤',n:''},{id:'m8t2',t:'è¨˜æ†¶é«”Q4å±•æœ›',n:''},{id:'m8t3',t:'å¹´åº•ä½œå¸³ä½ˆå±€',n:''}]}]},
  {id:'m9',n:9,r:'10/12ï½11/11',t:'å¹´åº•ä½œå¸³',ic:'ğŸ„',h:2,sec:[{st:'ğŸ“‹ ä½œå¸³',tk:[{id:'m9t1',t:'è¿½è¹¤æŠ•ä¿¡ä½œå¸³æ¨™çš„',n:''},{id:'m9t2',t:'è©•ä¼°åœåˆ©æˆ–çºŒæŠ±',n:''},{id:'m9t3',t:'Q3è²¡å ±é©—è­‰',n:''}]}]},
  {id:'m10',n:10,r:'11/12ï½12/11',t:'ç²åˆ©é–å®š',ic:'ğŸ”’',h:2,sec:[{st:'ğŸ“‹ å¹´æœ«',tk:[{id:'m10t1',t:'é–å®šç²åˆ©æ¸›å°‘æ›éšª',n:''},{id:'m10t2',t:'è¦åŠƒç¯€ç¨…',n:''},{id:'m10t3',t:'æ•´ç†å¹´åº¦å¿ƒå¾—',n:''}]}]},
  {id:'m11',n:11,r:'12/12ï½1/11',t:'å°é—œæº–å‚™',ic:'ğŸ§§',h:2,sec:[{st:'ğŸ“‹ å°é—œå‰',tk:[{id:'m11t1',t:'è©•ä¼°å°é—œå‰æ¸›ç¢¼',n:''},{id:'m11t2',t:'è¦åŠƒéå¹´è¿½è¹¤æ¸…å–®',n:''},{id:'m11t3',t:'æº–å‚™H2çµç®—',n:''}]}]},
  {id:'m12',n:12,r:'1/12ï½2/6',t:'å°é—œæ±ºç­–',ic:'ğŸ§§',h:2,sec:[{st:'ğŸ“‹ è¾²æ›†å°é—œå‰',tk:[{id:'m12t1',t:'å°é—œå‰è¨˜éŒ„æ‰€æœ‰æŒè‚¡ç¾åƒ¹',n:'å°é—œå‰ç´€éŒ„'},{id:'m12t2',t:'é€æª”æ±ºç­–ï¼šäº†çµ or çºŒæŠ±',n:'æ¯æª”éƒ½è¦æ±ºå®š'},{id:'m12t3',t:'è¨˜éŒ„å°é—œå‰åœ‹éš›ç›¤å‹¢',n:''},{id:'m12t4',t:'éå¹´æœŸé–“è¿½è¹¤æ¸…å–®ç¢ºèª',n:''}]}]},
  {id:'m13',n:13,r:'2/7ï½2/11',t:'ğŸ† å¹´åº¦ç¸½çµç®—',ic:'ğŸ†',h:2,isSt:1,sec:[{st:'ğŸ“Š å…¨å¹´åº¦çµç®—',tk:[{id:'m13t1',t:'å®Œæˆå¹´åº¦è‡ªå‹•çµç®—',n:''},{id:'m13t2',t:'åŒ¯å‡ºå¹´å ±çµ¦Claude',n:''},{id:'m13t3',t:'åˆ¶å®š2027å¹´åº¦è¨ˆç•«',n:''},{id:'m13t4',t:'å›é¡§13å€‹æœˆæŠ•è³‡ç´€å¾‹',n:''}]}]},
];
const GL=[
  {id:'g1',nm:'ç¾å…‰',tk:'MU',ct:'ğŸ‡ºğŸ‡¸',nt:'å½±éŸ¿å—äºç§‘/è¯é‚¦é›»/æ—ºå®'},
  {id:'g2',nm:'è¼é”',tk:'NVDA',ct:'ğŸ‡ºğŸ‡¸',nt:'å½±éŸ¿CoWoSæ—ç¾¤'},
  {id:'g3',nm:'SKæµ·åŠ›å£«',tk:'000660.KS',ct:'ğŸ‡°ğŸ‡·',nt:'HBM/DRAMå ±åƒ¹é¢¨å‘çƒ'},
  {id:'g4',nm:'ä¸‰æ˜Ÿé›»å­',tk:'005930.KS',ct:'ğŸ‡°ğŸ‡·',nt:'DRAM/NANDå¸‚ä½”ç¬¬ä¸€'},
  {id:'g5',nm:'è²»åŠ',tk:'SOX',ct:'ğŸ‡ºğŸ‡¸',nt:'åŠå°é«”æ™¯æ°£æŒ‡æ¨™'},
  {id:'g6',nm:'SpaceX',tk:'éä¸Šå¸‚',ct:'ğŸš€',nt:'ä½è»Œè¡›æ˜Ÿå‚¬åŒ–åŠ‘'},
];
const GI=[{g:'S',c:'#ffd700',d:'å®Œç¾ï¼šç´€å¾‹100%ã€æ­£å ±é…¬ã€é›¶è¡å‹•'},{g:'A',c:'#00e676',d:'å„ªè‰¯ï¼šç´€å¾‹ä½³ã€ç²åˆ©/æŒå¹³ã€â‰¤1æ›è‚¡'},{g:'B',c:'#64ffda',d:'åŠæ ¼ï¼šå°è™§å¯æ§ã€æ²’äº‚å‹•'},{g:'C',c:'#ff8c00',d:'æª¢è¨ï¼šé•è¦1-2æ¬¡ã€è¡å‹•äº¤æ˜“'},{g:'D',c:'#e74c3c',d:'å¤±æ§ï¼šå¤šæ¬¡é•è¦ã€æƒ…ç·’åŒ–æ“ä½œ'}];

// === STATE ===
const SK='bp2026v5';
let D={tasks:{},principles:{},holdings:[],wr:[],ms:[],pt:[]};
let cV='plan',cM='m1',_gr='';
function ld(){try{const s=localStorage.getItem(SK);if(s){D=JSON.parse(s);if(!D.holdings?.length)D.holdings=JSON.parse(JSON.stringify(DH));D.wr=D.wr||[];D.ms=D.ms||[];D.pt=D.pt||[]}}catch(e){} if(!D.holdings?.length)D.holdings=JSON.parse(JSON.stringify(DH))}
function sv(){localStorage.setItem(SK,JSON.stringify(D))}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}
function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function dow(d){return['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][new Date(d).getDay()]}
function fN(n){return n>=0?'+'+n.toLocaleString():n.toLocaleString()}
function mul(s){return s.unit==='è‚¡'?s.shares:s.shares*1000}

// === PROGRESS ===
function mProg(m){let t=0,d=0;m.sec.forEach(s=>s.tk.forEach(x=>{t++;if(D.tasks[x.id])d++}));return{t,d,p:t?Math.round(d/t*100):0}}
function tProg(){let t=0,d=0;MO.forEach(m=>{const p=mProg(m);t+=p.t;d+=p.d});return{t,d,p:t?Math.round(d/t*100):0}}
function hStats(){const h=D.holdings.filter(x=>!x.sold);return{cnt:h.length,z:h.reduce((s,x)=>s+(x.unit==='è‚¡'?0:x.shares),0),o:h.reduce((s,x)=>s+(x.unit==='è‚¡'?x.shares:0),0),tc:h.reduce((s,x)=>s+x.cost*mul(x),0)}}

// === RENDER ===
function render(){
  const tp=tProg();
  document.getElementById('tBar').style.width=tp.p+'%';
  document.getElementById('tTxt').textContent=`${tp.d}/${tp.t}ï¼ˆ${tp.p}%ï¼‰`;
  const hs=hStats();
  document.getElementById('headerSub').textContent=`2026/2ï½2027/2ï¼ˆ13å€‹æœˆï¼‰ï½œSone Wangï½œ${hs.z}å¼µ${hs.o?'+'+hs.o+'è‚¡':''}ï¼${hs.cnt}æª”`;
  const vs=[['plan','ğŸ“‹ä½œæˆ°'],['holdings','ğŸ’¼æŒè‚¡'],['tracker','ğŸ“é€±ç´€éŒ„'],['global','ğŸŒåœ‹éš›'],['settle','ğŸ’°æœˆçµç®—'],['profit','ğŸ’äº†çµ'],['half','ğŸ“ŠåŠå¹´å ±'],['targets','ğŸ¯ç›®æ¨™']];
  document.getElementById('vTabs').innerHTML=vs.map(([k,l])=>`<button class="tab ${cV===k?'on':''}" onclick="cV='${k}';render()">${l}</button>`).join('');
  const mt=document.getElementById('mTabs');
  if(cV==='plan'){mt.style.display='flex';
    mt.innerHTML=[1,2].map(half=>`<span class="f10 bold" style="color:${half===1?'var(--gold)':'var(--purple)'};padding:3px 5px">${half===1?'H1':'H2'}</span>`+MO.filter(m=>m.h===half).map(m=>{const p=mProg(m);return`<div class="mtab ${cM===m.id?'on':''} ${m.isSt?'half':''}" onclick="cM='${m.id}';render()"><span style="font-size:12px">${m.ic}</span><span style="color:${cM===m.id?'var(--cyan)':'var(--sub)'};font-weight:${cM===m.id?700:400}">${m.n}</span>${p.d?`<span class="mono" style="font-size:8px;padding:1px 4px;border-radius:8px;background:${p.p===100?'rgba(0,230,118,.2)':'rgba(100,255,218,.1)'};color:${p.p===100?'var(--green)':'var(--cyan)'}">${p.p}%</span>`:''}</div>`}).join('')).join('')}
  else mt.style.display='none';
  const c=document.getElementById('C');c.innerHTML='';
  ({plan:rPlan,holdings:rHold,tracker:rTrack,global:rGlob,settle:rSettl,profit:rProf,half:rHalf,targets:rTarg})[cV]?.(c);
}

// === PLAN ===
function rPlan(c){
  const m=MO.find(x=>x.id===cM);if(!m)return;const mp=mProg(m);
  let h=`<div class="fade"><div style="margin-bottom:14px">
    <div class="flex center gap8"><h2 style="font-size:17px;font-weight:700">${m.ic} ç¬¬${m.n}å€‹æœˆï¼š${m.r}</h2>${m.isSt?'<span class="sell-tag">çµç®—æœˆ</span>':''}<span style="padding:2px 8px;border-radius:4px;font-size:10px;font-weight:700;background:${m.h===1?'rgba(255,215,0,.1)':'rgba(187,134,252,.1)'};color:${m.h===1?'var(--gold)':'var(--purple)'}">H${m.h}</span></div>
    <p style="font-size:14px;background:linear-gradient(90deg,var(--cyan),var(--cyan2));-webkit-background-clip:text;-webkit-text-fill-color:transparent">ã€Œ${m.t}ã€</p>
    <div class="flex center gap8" style="margin-top:6px"><div style="flex:1;max-width:160px;height:4px;background:rgba(100,255,218,.08);border-radius:3px;overflow:hidden"><div style="height:100%;width:${mp.p}%;background:${mp.p===100?'var(--green)':'var(--cyan)'}"></div></div><span class="mono f11" style="color:var(--sub)">${mp.d}/${mp.t}</span></div></div>`;
  m.sec.forEach(sec=>{
    h+=`<div class="card"><div class="card-head"><h3>${sec.st}</h3></div>`;
    sec.tk.forEach(tk=>{const dn=D.tasks[tk.id];const nt=D.tasks[tk.id+'_n']||tk.n||'';
      h+=`<div class="task-row" style="opacity:${dn?.5:1}"><div class="chk ${dn?'done':''}" onclick="D.tasks['${tk.id}']=!D.tasks['${tk.id}'];sv();render()">${dn?'<span style="color:var(--green);font-size:13px;font-weight:900">âœ“</span>':''}</div><div style="flex:1"><p class="f13" style="color:${dn?'var(--sub)':'#d0dae4'};text-decoration:${dn?'line-through':'none'}">${tk.t}</p><p class="f11" style="color:var(--sub2);margin-top:2px;cursor:pointer" onclick="eN('${tk.id}')" id="n_${tk.id}">${nt||'ï¼‹å‚™è¨»'}</p></div></div>`});
    h+=`</div>`;
  });
  if(cM==='m1'){h+=`<div class="card" style="border-color:rgba(231,76,60,.15);background:rgba(231,76,60,.03)"><div class="card-head" style="background:rgba(231,76,60,.06)"><h3 style="color:var(--red)">ğŸ›¡ï¸ æ ¸å¿ƒåŸå‰‡</h3></div>`;
    PR.forEach(p=>{const d=D.principles[p.id];h+=`<div class="task-row"><div class="chk red ${d?'done':''}" onclick="D.principles['${p.id}']=!D.principles['${p.id}'];sv();render()">${d?'<span style="color:var(--red);font-size:13px;font-weight:900">âœ“</span>':''}</div><p class="f13" style="color:#e0a0a0;font-weight:500">${p.t}</p></div>`});h+=`</div>`}
  h+=`</div>`;c.innerHTML=h;
}
function eN(id){const el=document.getElementById('n_'+id);if(!el)return;const cur=D.tasks[id+'_n']||'';
  el.innerHTML=`<div class="flex gap6"><input class="inp" id="ni_${id}" value="${esc(cur)}" style="flex:1;font-size:12px;padding:4px 8px" onkeydown="if(event.key==='Enter'){D.tasks['${id}_n']=this.value;sv();render()}"><button class="btn btn-p" style="padding:3px 8px;font-size:11px" onclick="D.tasks['${id}_n']=document.getElementById('ni_${id}').value;sv();render()">å­˜</button><button class="btn btn-s" onclick="render()">âœ•</button></div>`;document.getElementById('ni_'+id)?.focus()}

// === HOLDINGS ===
function rHold(c){
  const act=D.holdings.filter(x=>!x.sold),sold=D.holdings.filter(x=>x.sold),hs=hStats();
  let h=`<div class="fade"><div class="flex between center wrap gap8" style="margin-bottom:14px"><div><h2 class="f16 bold">ğŸ’¼ æŒè‚¡ç®¡ç†</h2><p class="f12" style="color:var(--sub)">${hs.cnt}æª”ï½œ${hs.z}å¼µ${hs.o?'+'+hs.o+'è‚¡':''}ï½œæˆæœ¬$${hs.tc.toLocaleString()}</p></div><button class="btn btn-p" onclick="sAH()">ï¼‹ æ–°å¢</button></div><div id="ahA"></div>`;
  act.forEach(s=>{h+=`<div class="card" style="padding:12px 16px"><div class="flex between center wrap gap8"><div style="min-width:120px"><p class="f14 bold">${s.name} <span class="f11" style="color:var(--sub2)">${s.code}</span></p><p class="mono f11" style="color:var(--sub2)">${s.shares}${s.unit}ï½œ$${s.cost}ï½œç›®æ¨™$${s.target||'â€”'}</p><p class="f11" style="color:var(--sub3)">${s.strat||''}</p></div><div class="flex gap6"><button class="btn btn-s" onclick="eH('${s.id}')">âœï¸</button><button class="btn btn-d" onclick="dH('${s.id}')">ğŸ—‘ï¸</button></div></div></div>`});
  if(sold.length){h+=`<h3 class="f13" style="color:var(--sub);margin:14px 0 8px">ğŸ“¤ å·²äº†çµ</h3>`;sold.forEach(s=>h+=`<div class="card" style="padding:8px 16px;opacity:.5"><p class="f12" style="text-decoration:line-through">${s.name} ${s.code} ${s.shares}${s.unit} <span class="sell-tag">å·²äº†çµ</span></p></div>`)}
  h+=`</div>`;c.innerHTML=h;
}
function sAH(){const a=document.getElementById('ahA');if(a.innerHTML){a.innerHTML='';return}
  a.innerHTML=`<div class="card" style="padding:14px;border-color:rgba(100,255,218,.2);margin-bottom:14px"><h3 class="f14 bold" style="color:var(--cyan);margin-bottom:10px">ï¼‹ æ–°å¢æŒè‚¡</h3><div class="grid3" style="margin-bottom:10px"><div><label class="f11" style="color:var(--sub)">åç¨±</label><input class="inp" id="an" placeholder="å•Ÿç¢"></div><div><label class="f11" style="color:var(--sub)">ä»£è™Ÿ</label><input class="inp" id="ac" placeholder="6285"></div><div><label class="f11" style="color:var(--sub)">å–®ä½</label><select class="inp" id="au"><option value="å¼µ">å¼µ</option><option value="è‚¡">è‚¡</option></select></div></div><div class="grid3" style="margin-bottom:10px"><div><label class="f11" style="color:var(--sub)">æ•¸é‡</label><input class="inp" id="as" type="number" value="1"></div><div><label class="f11" style="color:var(--sub)">æˆæœ¬</label><input class="inp" id="ap" type="number" step="0.01"></div><div><label class="f11" style="color:var(--sub)">ç›®æ¨™</label><input class="inp" id="at"></div></div><div style="margin-bottom:10px"><input class="inp" id="ast" placeholder="ç­–ç•¥å‚™è¨»"></div><div class="flex gap8"><button class="btn btn-p" style="flex:1" onclick="aH()">ğŸ’¾ æ–°å¢</button><button class="btn btn-d" onclick="document.getElementById('ahA').innerHTML=''">å–æ¶ˆ</button></div></div>`}
function aH(){const n=document.getElementById('an').value,cd=document.getElementById('ac').value;if(!n||!cd)return toast('âš ï¸ å¡«åç¨±å’Œä»£è™Ÿ');D.holdings.push({id:'h_'+Date.now(),name:n,code:cd,shares:parseFloat(document.getElementById('as').value)||1,unit:document.getElementById('au').value,cost:parseFloat(document.getElementById('ap').value)||0,target:document.getElementById('at').value,strat:document.getElementById('ast').value});sv();render();toast('âœ… å·²æ–°å¢'+n)}
function eH(id){const s=D.holdings.find(x=>x.id===id);if(!s)return;const ns=prompt(`${s.name} ${s.shares}${s.unit}\næ–°æ•¸é‡ï¼ˆ0=åˆªé™¤ï¼‰:`,s.shares);if(ns===null)return;if(parseFloat(ns)<=0)return dH(id);s.shares=parseFloat(ns);const nc=prompt('æˆæœ¬å‡åƒ¹:',s.cost);if(nc!==null)s.cost=parseFloat(nc)||s.cost;const nt=prompt('ç›®æ¨™åƒ¹:',s.target);if(nt!==null)s.target=nt;const nst=prompt('ç­–ç•¥:',s.strat);if(nst!==null)s.strat=nst;sv();render();toast('âœ… å·²æ›´æ–°'+s.name)}
function dH(id){if(!confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ'))return;D.holdings=D.holdings.filter(x=>x.id!==id);sv();render();toast('ğŸ—‘ï¸ å·²åˆªé™¤')}

// === PROFIT TAKE ===
function rProf(c){
  const tr=D.pt.reduce((s,r)=>s+(r.pnl||0),0);
  let h=`<div class="fade"><div class="flex between center wrap gap8" style="margin-bottom:14px"><div><h2 class="f16 bold">ğŸ’ ç²åˆ©äº†çµ</h2><p class="f12" style="color:var(--sub)">è³£å‡º â†’ è‡ªå‹•ç®—å¯¦ç¾æç›Š</p></div><button class="btn btn-g" onclick="sPF()">ï¼‹ æ–°å¢</button></div><div id="pfA"></div>`;
  if(D.pt.length)h+=`<div style="padding:10px 14px;border-radius:8px;background:${tr>=0?'rgba(0,230,118,.06)':'rgba(255,82,82,.06)'};border:1px solid ${tr>=0?'rgba(0,230,118,.15)':'rgba(255,82,82,.15)'};margin-bottom:14px"><span class="f12" style="color:var(--sub)">ç´¯è¨ˆå¯¦ç¾æç›Šï¼š</span><span class="mono bold f16" style="color:${tr>=0?'var(--green)':'var(--red)'}">${fN(tr)}</span></div>`;
  if(!D.pt.length)h+=`<div style="text-align:center;padding:40px;color:var(--sub4)"><p style="font-size:48px">ğŸ’</p><p class="f14">å°šç„¡äº†çµç´€éŒ„</p></div>`;
  else[...D.pt].reverse().forEach(r=>{const ps=r.pnl>=0;h+=`<div class="card" style="padding:12px"><div class="flex between center" style="margin-bottom:6px"><div class="flex center gap8"><span class="sell-tag">${r.act||'è³£å‡º'}</span><span class="bold f13">${r.nm} ${r.cd}</span><span class="mono f11" style="color:var(--sub)">${r.dt}</span></div><button class="btn btn-d" onclick="if(confirm('åˆªé™¤ï¼Ÿ')){D.pt=D.pt.filter(x=>x.id!=='${r.id}');sv();render()}">åˆªé™¤</button></div><div class="gridf" style="gap:6px">${[['æ•¸é‡',r.qty+(r.ut||'å¼µ')],['æˆæœ¬','$'+r.cp],['è³£åƒ¹','$'+r.sp],['æç›Š',fN(r.pnl),1]].map(([l,v,hl])=>`<div style="padding:4px 8px;border-radius:6px;background:${hl?(ps?'rgba(0,230,118,.08)':'rgba(255,82,82,.08)'):'rgba(100,255,218,.04)'}"><p class="f10" style="color:var(--sub2)">${l}</p><p class="mono bold f12" style="color:${hl?(ps?'var(--green)':'var(--red)'):'var(--txt)'}">${v}</p></div>`).join('')}</div>${r.memo?`<p class="f11" style="color:var(--sub3);margin-top:6px;padding:4px 8px;background:rgba(100,255,218,.03);border-radius:4px">ğŸ’­ ${esc(r.memo)}</p>`:''}</div>`});
  h+=`</div>`;c.innerHTML=h;
}
function sPF(){const a=document.getElementById('pfA');if(a.innerHTML){a.innerHTML='';return}
  const act=D.holdings.filter(x=>!x.sold),td=new Date().toISOString().slice(0,10);
  a.innerHTML=`<div class="card" style="padding:14px;border-color:rgba(255,215,0,.2);margin-bottom:14px"><h3 class="f14 bold" style="color:var(--gold);margin-bottom:10px">ğŸ’ æ–°å¢äº†çµ</h3><div class="grid2" style="margin-bottom:10px"><div><label class="f11" style="color:var(--sub)">æŒè‚¡</label><select class="inp" id="pfs" onchange="pFC()"><option value="">é¸æ“‡</option>${act.map(s=>`<option value="${s.id}">${s.name}(${s.code}) ${s.shares}${s.unit} @${s.cost}</option>`).join('')}<option value="x">ğŸ“è‡ªè¨‚</option></select></div><div><label class="f11" style="color:var(--sub)">æ—¥æœŸ</label><input type="date" class="inp" id="pfd" value="${td}"></div></div><div id="pfC" style="display:none" class="grid3" style="margin-bottom:10px"><div><label class="f11" style="color:var(--sub)">åç¨±</label><input class="inp" id="pfcn"></div><div><label class="f11" style="color:var(--sub)">ä»£è™Ÿ</label><input class="inp" id="pfcc"></div><div><label class="f11" style="color:var(--sub)">æˆæœ¬</label><input class="inp" id="pfcp" type="number" step="0.01"></div></div><div class="grid3" style="margin-bottom:10px"><div><label class="f11" style="color:var(--sub)">è³£å‡ºæ•¸é‡</label><input class="inp" id="pfq" type="number" value="1"></div><div><label class="f11" style="color:var(--sub)">å–®ä½</label><select class="inp" id="pfu"><option value="å¼µ">å¼µ</option><option value="è‚¡">è‚¡</option></select></div><div><label class="f11" style="color:var(--sub)">è³£å‡ºåƒ¹</label><input class="inp" id="pfsp" type="number" step="0.01" oninput="cPF()"></div></div><div style="padding:8px 12px;border-radius:8px;background:rgba(255,215,0,.06);border:1px solid rgba(255,215,0,.12);margin-bottom:10px" class="flex between center"><span class="f12" style="color:var(--sub)">é ä¼°æç›Šï¼š</span><span class="mono bold f16" id="pfPnl" style="color:var(--sub)">â€”</span></div><div style="margin-bottom:10px"><textarea class="inp" id="pfm" rows="2" placeholder="ç‚ºä»€éº¼è³£ï¼Ÿ"></textarea></div><div class="flex gap8"><button class="btn btn-g" style="flex:1" onclick="savPF()">ğŸ’ ç¢ºèªäº†çµ</button><button class="btn btn-d" onclick="document.getElementById('pfA').innerHTML=''">å–æ¶ˆ</button></div></div>`}
function pFC(){const v=document.getElementById('pfs').value;document.getElementById('pfC').style.display=v==='x'?'grid':'none';if(v&&v!=='x'){const s=D.holdings.find(x=>x.id===v);if(s){document.getElementById('pfu').value=s.unit;document.getElementById('pfq').value=s.shares}}cPF()}
function cPF(){const sid=document.getElementById('pfs').value;let cost=0;if(sid==='x')cost=parseFloat(document.getElementById('pfcp')?.value)||0;else{const s=D.holdings.find(x=>x.id===sid);if(s)cost=s.cost}const sp=parseFloat(document.getElementById('pfsp').value)||0,qty=parseFloat(document.getElementById('pfq').value)||0,ut=document.getElementById('pfu').value,m=ut==='è‚¡'?1:1000,pnl=Math.round((sp-cost)*qty*m);const el=document.getElementById('pfPnl');if(sp&&cost&&qty){el.textContent=fN(pnl);el.style.color=pnl>=0?'var(--green)':'var(--red)'}else{el.textContent='â€”';el.style.color='var(--sub)'}}
function savPF(){const sid=document.getElementById('pfs').value;let nm='',cd='',cp=0;if(sid==='x'){nm=document.getElementById('pfcn').value;cd=document.getElementById('pfcc').value;cp=parseFloat(document.getElementById('pfcp').value)||0}else{const s=D.holdings.find(x=>x.id===sid);if(!s)return toast('âš ï¸è«‹é¸æ“‡');nm=s.name;cd=s.code;cp=s.cost}const qty=parseFloat(document.getElementById('pfq').value)||0,ut=document.getElementById('pfu').value,sp=parseFloat(document.getElementById('pfsp').value)||0,m=ut==='è‚¡'?1:1000,pnl=Math.round((sp-cp)*qty*m);if(!nm||!sp)return toast('âš ï¸è«‹å¡«å®Œ');D.pt.push({id:'pt_'+Date.now(),dt:document.getElementById('pfd').value,nm,cd,qty,ut,cp,sp,pnl,memo:document.getElementById('pfm').value,act:pnl>=0?'ç²åˆ©äº†çµ':'åœæäº†çµ'});if(sid&&sid!=='x'){const s=D.holdings.find(x=>x.id===sid);if(s){if(qty>=s.shares)s.sold=true;else s.shares-=qty}}sv();render();toast(pnl>=0?'ğŸ’ ç²åˆ©äº†çµï¼':'ğŸ›‘ åœæäº†çµ')}

// === WEEKLY TRACKER ===
function rTrack(c){
  const act=D.holdings.filter(x=>!x.sold);
  let h=`<div class="fade"><div class="flex between center wrap gap8" style="margin-bottom:14px"><div><h2 class="f16 bold">ğŸ“ æ¯é€±ç´€éŒ„</h2><p class="f12" style="color:var(--sub)">é€±ä¸€é–‹ç›¤ï¼‹é€±äº”æ”¶ç›¤ï¼‹å°é—œå‰</p></div><button class="btn btn-p" onclick="sRF()">ï¼‹ æ–°å¢</button></div><div id="rfA"></div>`;
  if(!D.wr.length)h+=`<div style="text-align:center;padding:40px;color:var(--sub4)"><p style="font-size:48px">ğŸ“</p><p class="f14">å°šç„¡ç´€éŒ„</p></div>`;
  else[...D.wr].reverse().forEach(r=>{const ty=r.ty||r.tp||'fri';const iM=ty==='mon';const iC=ty==='close';
    const bc=iC?'rgba(255,215,0,.1)':iM?'rgba(0,230,118,.1)':'rgba(255,82,82,.1)';
    const lbBg=iC?'rgba(255,215,0,.15)':iM?'rgba(0,230,118,.15)':'rgba(255,82,82,.15)';
    const lbC=iC?'var(--gold)':iM?'var(--green)':'var(--red)';
    const lbT=iC?'ğŸ§§å°é—œå‰':iM?'ğŸŸ¢é€±ä¸€':'ğŸ”´é€±äº”';
    h+=`<div class="card" style="padding:12px;border-color:${bc}"><div class="flex between center" style="margin-bottom:6px"><div class="flex center gap8"><span style="padding:2px 8px;border-radius:4px;font-size:11px;font-weight:700;background:${lbBg};color:${lbC}">${lbT}</span><span class="mono bold f13">${r.dt}ï¼ˆ${dow(r.dt)}ï¼‰</span></div><div class="flex gap6"><button class="btn btn-s" onclick="eWR('${r.id}')">âœï¸ç·¨è¼¯</button><button class="btn btn-d" onclick="if(confirm('åˆªé™¤ï¼Ÿ')){D.wr=D.wr.filter(x=>x.id!=='${r.id}');sv();render()}">åˆªé™¤</button></div></div>`;
    const hf=r.hs?.filter(x=>x.p)||[];const hasDec=hf.some(x=>x.dec);
    if(hf.length){h+=`<div style="overflow-x:auto;margin-bottom:6px"><table style="width:100%;border-collapse:collapse;font-size:11px"><tr style="border-bottom:1px solid rgba(100,255,218,.08)"><th style="padding:3px 6px;color:var(--sub2);text-align:left">è‚¡ç¥¨</th><th style="padding:3px;text-align:center;color:var(--sub2)">é‡</th><th style="padding:3px;text-align:center;color:var(--sub2)">æˆæœ¬</th><th style="padding:3px;text-align:center;color:var(--sub2)">ç¾åƒ¹</th><th style="padding:3px;text-align:right;color:var(--sub2)">æç›Š</th>${hasDec?'<th style="padding:3px;text-align:center;color:var(--gold)">æ±ºç­–</th>':''}</tr>`;
      const decC={'çºŒæŠ±':'var(--green)','äº†çµ':'var(--gold)','è§€å¯Ÿ':'var(--cyan)','åŠ ç¢¼':'var(--blue)','æ¸›ç¢¼':'var(--orange)'};
      hf.forEach(x=>{const ng=String(x.pnl).startsWith('-');h+=`<tr style="border-bottom:1px solid rgba(100,255,218,.03)"><td style="padding:2px 6px;color:var(--sub3)">${x.nm}</td><td class="mono" style="text-align:center;color:var(--cyan)">${x.sh}${x.ut||'å¼µ'}</td><td class="mono" style="text-align:center;color:var(--sub2)">${x.c||''}</td><td class="mono" style="text-align:center">${x.p}</td><td class="mono bold" style="text-align:right;color:${ng?'var(--red)':'var(--green)'}">${x.pnl||''}</td>${hasDec?`<td style="text-align:center;font-weight:700;font-size:10px;color:${decC[x.dec]||'var(--sub)'}">${x.dec||''}</td>`:''}</tr>`});h+=`</table></div>`}
    const gf=r.gl?.filter(x=>x.p)||[];
    if(gf.length){h+=`<div class="flex wrap gap4" style="margin-bottom:6px">`;gf.forEach(x=>h+=`<div style="padding:2px 8px;border-radius:4px;font-size:10px;background:rgba(255,140,0,.06);border:1px solid rgba(255,140,0,.08)"><span style="color:var(--orange)">${x.nm}</span> <span class="mono">${x.p}</span>${x.ch?` <span style="color:${String(x.ch).startsWith('-')?'var(--red)':'var(--green)'}">${x.ch}</span>`:''}</div>`);h+=`</div>`}
    if(r.tv||r.tp){h+=`<div class="flex gap10 f11" style="padding:4px 8px;border-radius:4px;background:rgba(100,255,218,.03)">`;if(r.tv)h+=`<span style="color:var(--sub)">å¸‚å€¼:<span class="mono bold" style="color:var(--cyan)">${r.tv}</span></span>`;if(r.tp)h+=`<span style="color:var(--sub)">æç›Š:<span class="mono bold" style="color:${String(r.tp).startsWith('-')?'var(--red)':'var(--green)'}">${r.tp}</span></span>`;if(r.tpc)h+=`<span style="color:var(--sub)">å ±é…¬:<span class="mono bold" style="color:${String(r.tpc).startsWith('-')?'var(--red)':'var(--green)'}">${r.tpc}</span></span>`;h+=`</div>`}
    if(r.memo)h+=`<p class="f11" style="color:var(--sub3);margin-top:6px;padding:4px 8px;background:rgba(100,255,218,.03);border-radius:4px">ğŸ’­ ${esc(r.memo)}</p>`;
    h+=`</div>`;
  });
  h+=`</div>`;c.innerHTML=h;
}
function sRF(){const a=document.getElementById('rfA');if(a.innerHTML){a.innerHTML='';return}
  const act=D.holdings.filter(x=>!x.sold),td=new Date().toISOString().slice(0,10);
  let h=`<div class="card" style="padding:14px;border-color:rgba(100,255,218,.2);margin-bottom:14px"><h3 class="f14 bold" style="color:var(--cyan);margin-bottom:10px">ğŸ“‹ æ–°å¢é€±ç´€éŒ„</h3><div class="grid2" style="margin-bottom:10px"><div><label class="f11" style="color:var(--sub)">æ—¥æœŸ</label><input type="date" class="inp" id="rd" value="${td}"></div><div><label class="f11" style="color:var(--sub)">é¡å‹</label><select class="inp" id="rt"><option value="mon">ğŸŸ¢ é€±ä¸€</option><option value="fri">ğŸ”´ é€±äº”</option><option value="close">ğŸ§§ å°é—œå‰</option></select></div></div>
  <h4 class="f12" style="color:var(--sub3);margin-bottom:6px">ğŸ‡¹ğŸ‡¼ æŒè‚¡ï¼ˆè¼¸å…¥ç¾åƒ¹è‡ªå‹•ç®—ï¼‰</h4><div style="overflow-x:auto;margin-bottom:8px"><table style="width:100%;border-collapse:collapse;font-size:12px"><tr style="border-bottom:1px solid rgba(100,255,218,.1)"><th style="padding:4px 6px;color:var(--sub);text-align:left">è‚¡ç¥¨</th><th style="padding:4px;text-align:center;color:var(--sub)">é‡</th><th style="padding:4px;text-align:center;color:var(--sub)">æˆæœ¬</th><th style="padding:4px;text-align:left;color:var(--sub)">ç¾åƒ¹</th><th style="padding:4px;text-align:right;color:var(--sub)">æç›Š</th><th style="padding:4px;text-align:center;color:var(--gold)">æ±ºç­–</th></tr>`;
  act.forEach((s,i)=>h+=`<tr style="border-bottom:1px solid rgba(100,255,218,.04)"><td style="padding:4px 6px;font-weight:600">${s.name}<span class="f10" style="color:var(--sub2);margin-left:3px">${s.code}</span></td><td class="mono f11" style="text-align:center;color:var(--cyan)">${s.shares}${s.unit}</td><td class="mono f11" style="text-align:center;color:var(--sub3)">${s.cost}</td><td style="padding:3px 2px"><input class="inp" id="rh${i}" type="number" step="0.1" style="width:80px;padding:3px 6px;font-size:11px" oninput="cWR()"></td><td class="mono bold f11" style="text-align:right" id="rhp${i}">â€”</td><td style="padding:3px 2px"><select class="inp" id="rd${i}" style="width:68px;padding:2px 4px;font-size:10px;font-family:var(--sans)"><option value="">â€”</option><option value="çºŒæŠ±">çºŒæŠ±</option><option value="äº†çµ">äº†çµ</option><option value="è§€å¯Ÿ">è§€å¯Ÿ</option><option value="åŠ ç¢¼">åŠ ç¢¼</option><option value="æ¸›ç¢¼">æ¸›ç¢¼</option></select></td></tr>`);
  h+=`</table></div><div id="rSum" class="flex between wrap gap8" style="padding:8px 12px;border-radius:8px;background:rgba(100,255,218,.06);border:1px solid rgba(100,255,218,.12);margin-bottom:10px;font-size:12px"><span>å¡«å…¥ç¾åƒ¹å¾Œè‡ªå‹•è¨ˆç®—</span></div>
  <h4 class="f12" style="color:var(--orange);margin-bottom:6px">ğŸŒ åœ‹éš›</h4><div class="gridf" style="margin-bottom:10px;gap:6px">`;
  GL.filter(g=>g.tk!=='éä¸Šå¸‚').forEach((g,i)=>h+=`<div class="flex gap4 center"><span class="f10" style="color:var(--sub3);min-width:45px">${g.nm}</span><input class="inp" id="rg${i}p" placeholder="åƒ¹æ ¼" style="width:60px;padding:3px 5px;font-size:11px"><input class="inp" id="rg${i}c" placeholder="%" style="width:45px;padding:3px 5px;font-size:11px"></div>`);
  h+=`</div><div style="margin-bottom:10px"><textarea class="inp" id="rm" rows="2" placeholder="å‚™å¿˜éŒ„..."></textarea></div><div class="flex gap8"><button class="btn btn-p" style="flex:1" onclick="savWR()">ğŸ’¾ å„²å­˜</button><button class="btn btn-d" onclick="document.getElementById('rfA').innerHTML=''">å–æ¶ˆ</button></div></div>`;
  a.innerHTML=h;
}
function cWR(){const act=D.holdings.filter(x=>!x.sold);let tv=0,tc=0,all=true;
  act.forEach((s,i)=>{const p=parseFloat(document.getElementById('rh'+i)?.value);const m=mul(s);tc+=s.cost*m;
    if(p&&!isNaN(p)){tv+=p*m;const pnl=Math.round((p-s.cost)*m);document.getElementById('rhp'+i).innerHTML=`<span style="color:${pnl>=0?'var(--green)':'var(--red)'}">${fN(pnl)}</span>`}
    else{all=false;document.getElementById('rhp'+i).textContent='â€”'}});
  const sum=document.getElementById('rSum');
  if(all){const pnl=Math.round(tv-tc),pct=((tv-tc)/tc*100).toFixed(1),pos=pnl>=0,cl=pos?'var(--green)':'var(--red)';
    sum.innerHTML=`<span>å¸‚å€¼:<span class="mono bold" style="color:var(--cyan)">$${tv.toLocaleString()}</span></span><span>æˆæœ¬:<span class="mono" style="color:var(--sub3)">$${tc.toLocaleString()}</span></span><span>æç›Š:<span class="mono bold" style="color:${cl}">${fN(pnl)}</span></span><span>å ±é…¬:<span class="mono bold" style="color:${cl}">${pos?'+':''}${pct}%</span></span>`}
}
function savWR(){const act=D.holdings.filter(x=>!x.sold);let tv=0,tc=0;
  const hs=act.map((s,i)=>{const p=parseFloat(document.getElementById('rh'+i)?.value)||0;const m=mul(s);tc+=s.cost*m;tv+=p*m;const pnl=Math.round((p-s.cost)*m);const dec=document.getElementById('rd'+i)?.value||'';return{cd:s.code,nm:s.name,sh:s.shares,ut:s.unit,c:s.cost,p:p||'',pnl:pnl?fN(pnl):'',dec}});
  const tpnl=Math.round(tv-tc),tpc=tc?((tv-tc)/tc*100).toFixed(1):'0';
  D.wr.push({id:'wr_'+Date.now(),dt:document.getElementById('rd').value,ty:document.getElementById('rt').value,hs,
    gl:GL.filter(g=>g.tk!=='éä¸Šå¸‚').map((g,i)=>({tk:g.tk,nm:g.nm,p:document.getElementById('rg'+i+'p')?.value||'',ch:document.getElementById('rg'+i+'c')?.value||''})),
    tv:tv?'$'+tv.toLocaleString():'',tc:'$'+tc.toLocaleString(),tp:tpnl?fN(tpnl):'',tpc:tpc?(parseFloat(tpc)>=0?'+':'')+tpc+'%':'',memo:document.getElementById('rm').value});
  sv();render();toast('âœ… å·²å„²å­˜');
}
function eWR(id){
  const r=D.wr.find(x=>x.id===id);if(!r)return;
  const act=D.holdings.filter(x=>!x.sold);
  const rty=r.ty||r.tp||'fri';
  let h=`<div class="card" style="padding:14px;border-color:rgba(100,255,218,.25);margin-bottom:14px"><h3 class="f14 bold" style="color:var(--cyan);margin-bottom:10px">âœï¸ ç·¨è¼¯é€±ç´€éŒ„</h3>
  <div class="grid2" style="margin-bottom:10px"><div><label class="f11" style="color:var(--sub)">æ—¥æœŸ</label><input type="date" class="inp" id="erd" value="${r.dt}"></div><div><label class="f11" style="color:var(--sub)">é¡å‹</label><select class="inp" id="ert"><option value="mon" ${rty==='mon'?'selected':''}>ğŸŸ¢ é€±ä¸€</option><option value="fri" ${rty==='fri'?'selected':''}>ğŸ”´ é€±äº”</option><option value="close" ${rty==='close'?'selected':''}>ğŸ§§ å°é—œå‰</option></select></div></div>
  <h4 class="f12" style="color:var(--sub3);margin-bottom:6px">ğŸ‡¹ğŸ‡¼ æŒè‚¡</h4><div style="overflow-x:auto;margin-bottom:8px"><table style="width:100%;border-collapse:collapse;font-size:12px"><tr style="border-bottom:1px solid rgba(100,255,218,.1)"><th style="padding:4px 6px;color:var(--sub);text-align:left">è‚¡ç¥¨</th><th style="padding:4px;text-align:center;color:var(--sub)">é‡</th><th style="padding:4px;text-align:center;color:var(--sub)">æˆæœ¬</th><th style="padding:4px;text-align:left;color:var(--sub)">ç¾åƒ¹</th><th style="padding:4px;text-align:right;color:var(--sub)">æç›Š</th><th style="padding:4px;text-align:center;color:var(--gold)">æ±ºç­–</th></tr>`;
  act.forEach((s,i)=>{const old=r.hs?.find(x=>x.cd===s.code);const pv=old?.p||'';const dv=old?.dec||'';
    h+=`<tr style="border-bottom:1px solid rgba(100,255,218,.04)"><td style="padding:4px 6px;font-weight:600">${s.name}<span class="f10" style="color:var(--sub2);margin-left:3px">${s.code}</span></td><td class="mono f11" style="text-align:center;color:var(--cyan)">${s.shares}${s.unit}</td><td class="mono f11" style="text-align:center;color:var(--sub3)">${s.cost}</td><td style="padding:3px 2px"><input class="inp" id="erh${i}" type="number" step="0.1" value="${pv}" style="width:80px;padding:3px 6px;font-size:11px" oninput="cER()"></td><td class="mono bold f11" style="text-align:right" id="erhp${i}">â€”</td><td style="padding:3px 2px"><select class="inp" id="erd${i}" style="width:68px;padding:2px 4px;font-size:10px;font-family:var(--sans)"><option value="">â€”</option><option value="çºŒæŠ±" ${dv==='çºŒæŠ±'?'selected':''}>çºŒæŠ±</option><option value="äº†çµ" ${dv==='äº†çµ'?'selected':''}>äº†çµ</option><option value="è§€å¯Ÿ" ${dv==='è§€å¯Ÿ'?'selected':''}>è§€å¯Ÿ</option><option value="åŠ ç¢¼" ${dv==='åŠ ç¢¼'?'selected':''}>åŠ ç¢¼</option><option value="æ¸›ç¢¼" ${dv==='æ¸›ç¢¼'?'selected':''}>æ¸›ç¢¼</option></select></td></tr>`});
  h+=`</table></div><div id="erSum" class="flex between wrap gap8" style="padding:8px 12px;border-radius:8px;background:rgba(100,255,218,.06);border:1px solid rgba(100,255,218,.12);margin-bottom:10px;font-size:12px"><span>â€”</span></div>
  <h4 class="f12" style="color:var(--orange);margin-bottom:6px">ğŸŒ åœ‹éš›</h4><div class="gridf" style="margin-bottom:10px;gap:6px">`;
  GL.filter(g=>g.tk!=='éä¸Šå¸‚').forEach((g,i)=>{const old=r.gl?.find(x=>x.tk===g.tk);
    h+=`<div class="flex gap4 center"><span class="f10" style="color:var(--sub3);min-width:45px">${g.nm}</span><input class="inp" id="erg${i}p" value="${old?.p||''}" placeholder="åƒ¹æ ¼" style="width:60px;padding:3px 5px;font-size:11px"><input class="inp" id="erg${i}c" value="${old?.ch||''}" placeholder="%" style="width:45px;padding:3px 5px;font-size:11px"></div>`});
  h+=`</div><div style="margin-bottom:10px"><textarea class="inp" id="erm" rows="2" placeholder="å‚™å¿˜éŒ„...">${esc(r.memo||'')}</textarea></div>
  <div class="flex gap8"><button class="btn btn-p" style="flex:1" onclick="savER('${id}')">ğŸ’¾ å„²å­˜ä¿®æ”¹</button><button class="btn btn-d" onclick="render()">å–æ¶ˆ</button></div></div>`;
  // Replace the content area with edit form
  document.getElementById('C').querySelector('.fade').innerHTML=`<div class="flex between center wrap gap8" style="margin-bottom:14px"><div><h2 class="f16 bold">ğŸ“ æ¯é€±ç´€éŒ„</h2></div></div>`+h;
  setTimeout(cER,50);
}
function cER(){const act=D.holdings.filter(x=>!x.sold);let tv=0,tc=0,all=true;
  act.forEach((s,i)=>{const p=parseFloat(document.getElementById('erh'+i)?.value);const m=mul(s);tc+=s.cost*m;
    if(p&&!isNaN(p)){tv+=p*m;const pnl=Math.round((p-s.cost)*m);document.getElementById('erhp'+i).innerHTML=`<span style="color:${pnl>=0?'var(--green)':'var(--red)'}">${fN(pnl)}</span>`}
    else{all=false;if(document.getElementById('erhp'+i))document.getElementById('erhp'+i).textContent='â€”'}});
  const sum=document.getElementById('erSum');if(!sum)return;
  if(all){const pnl=Math.round(tv-tc),pct=((tv-tc)/tc*100).toFixed(1),pos=pnl>=0,cl=pos?'var(--green)':'var(--red)';
    sum.innerHTML=`<span>å¸‚å€¼:<span class="mono bold" style="color:var(--cyan)">$${tv.toLocaleString()}</span></span><span>æˆæœ¬:<span class="mono" style="color:var(--sub3)">$${tc.toLocaleString()}</span></span><span>æç›Š:<span class="mono bold" style="color:${cl}">${fN(pnl)}</span></span><span>å ±é…¬:<span class="mono bold" style="color:${cl}">${pos?'+':''}${pct}%</span></span>`}
  else sum.innerHTML=`<span class="f12" style="color:var(--sub)">å¡«å…¥æ‰€æœ‰ç¾åƒ¹å¾Œè‡ªå‹•è¨ˆç®—</span>`
}
function savER(id){const r=D.wr.find(x=>x.id===id);if(!r)return;
  const act=D.holdings.filter(x=>!x.sold);let tv=0,tc=0;
  r.dt=document.getElementById('erd').value;r.ty=document.getElementById('ert').value;
  r.hs=act.map((s,i)=>{const p=parseFloat(document.getElementById('erh'+i)?.value)||0;const m=mul(s);tc+=s.cost*m;tv+=p*m;const pnl=Math.round((p-s.cost)*m);const dec=document.getElementById('erd'+i)?.value||'';return{cd:s.code,nm:s.name,sh:s.shares,ut:s.unit,c:s.cost,p:p||'',pnl:pnl?fN(pnl):'',dec}});
  const tpnl=Math.round(tv-tc),tpc=tc?((tv-tc)/tc*100).toFixed(1):'0';
  r.gl=GL.filter(g=>g.tk!=='éä¸Šå¸‚').map((g,i)=>({tk:g.tk,nm:g.nm,p:document.getElementById('erg'+i+'p')?.value||'',ch:document.getElementById('erg'+i+'c')?.value||''}));
  r.tv=tv?'$'+tv.toLocaleString():'';r.tc='$'+tc.toLocaleString();r.tp=tpnl?fN(tpnl):'';r.tpc=tpc?(parseFloat(tpc)>=0?'+':'')+tpc+'%':'';
  r.memo=document.getElementById('erm').value;
  sv();render();toast('âœ… ç´€éŒ„å·²æ›´æ–°');
}
function rGlob(c){
  let h=`<div class="fade"><h2 class="f16 bold" style="margin-bottom:14px">ğŸŒ åœ‹éš›è¿½è¹¤</h2>`;
  [['ğŸ‡ºğŸ‡¸','#1e88e5','ç¾è‚¡'],['ğŸ‡°ğŸ‡·','#e74c3c','éŸ“è‚¡'],['ğŸš€','#ff8c00','å…¶ä»–']].forEach(([f,cl,lb])=>{
    const items=GL.filter(g=>g.ct===f);if(!items.length)return;
    h+=`<div class="card"><div class="card-head"><h3 style="color:${cl}">${f} ${lb}</h3></div>`;
    items.forEach(g=>h+=`<div style="padding:8px 16px;border-bottom:1px solid rgba(100,255,218,.04);display:flex;gap:12px;align-items:center"><div style="flex:1"><p class="f13 bold">${g.nm}</p><p class="mono f11" style="color:var(--sub2)">${g.tk}</p></div><p class="f12" style="color:var(--sub3)">${g.nt}</p></div>`);h+=`</div>`});
  h+=`<div class="card" style="padding:14px;background:rgba(255,140,0,.04);border-color:rgba(255,140,0,.12)"><h3 class="f13 bold" style="color:var(--orange);margin-bottom:6px">ğŸ“Œ è¿½è¹¤é‚è¼¯</h3><div class="f12" style="color:var(--sub3);line-height:2"><p>ğŸ”— ç¾å…‰æ¼²â†’å—äºç§‘/è¯é‚¦é›»/æ—ºå®è·Ÿæ¼²</p><p>ğŸ”— SKæµ·åŠ›å£«HBMâ†’DRAMå ±åƒ¹</p><p>ğŸ”— ä¸‰æ˜Ÿæ¸›ç”¢â†’ä¾›éœ€</p><p>ğŸ”— NVDAâ†’CoWoS</p><p>ğŸ”— è²»åŠå¼·â†’å°ç£åŠå°é«”</p><p>ğŸ”— SpaceXâ†’ä½è»Œè¡›æ˜Ÿ</p></div></div></div>`;
  c.innerHTML=h;
}

// === MONTHLY SETTLE ===
function rSettl(c){
  const gc={S:'#ffd700',A:'#00e676',B:'#64ffda',C:'#ff8c00',D:'#e74c3c'};
  let h=`<div class="fade"><div class="flex between center wrap gap8" style="margin-bottom:14px"><div><h2 class="f16 bold">ğŸ’° æœˆçµç®—</h2><p class="f12" style="color:var(--sub)">çµç®—â†’åŒ¯å‡ºâ†’è²¼çµ¦Claude</p></div><button class="btn btn-p" onclick="sSF()">ï¼‹ æ–°å¢</button></div><div id="sfA"></div>`;
  if(!D.ms.length)h+=`<div style="text-align:center;padding:40px;color:var(--sub4)"><p style="font-size:48px">ğŸ’°</p><p class="f14">å°šç„¡ç´€éŒ„</p></div>`;
  else[...D.ms].reverse().forEach(r=>{
    h+=`<div class="card" style="padding:14px"><div class="flex between center" style="margin-bottom:8px"><div class="flex center gap8"><span style="font-size:18px;font-weight:900;color:${gc[r.gr]||'var(--cyan)'}">${r.gr||'?'}</span><span class="bold f14">${r.mo}çµç®—</span></div><div class="flex gap6"><button class="btn btn-p" style="padding:4px 10px;font-size:11px" onclick="exS('${r.id}')">ğŸ“¤åŒ¯å‡º</button><button class="btn btn-d" onclick="if(confirm('åˆªé™¤ï¼Ÿ')){D.ms=D.ms.filter(x=>x.id!=='${r.id}');sv();render()}">åˆªé™¤</button></div></div>`;
    h+=`<div class="gridf" style="gap:6px;margin-bottom:8px">`;
    [['å¸‚å€¼',r.ev],['æç›Š',r.pa,1],['å ±é…¬',r.pp,1],['æœ€ä½³',r.bs],['æœ€å·®',r.ws],['é…æ¯',r.dv],['äº¤æ˜“',r.tr],['å·²å¯¦ç¾',r.rp,1]].filter(([,v])=>v).forEach(([l,v,hl])=>h+=`<div style="padding:4px 8px;border-radius:6px;background:rgba(100,255,218,.04)"><p class="f10" style="color:var(--sub2)">${l}</p><p class="mono bold f12" style="color:${hl?(String(v).startsWith('-')?'var(--red)':'var(--green)'):'var(--txt)'}">${v}</p></div>`);
    h+=`</div>`;
    if(r.sd?.length){h+=`<details style="margin-bottom:8px"><summary class="f11" style="color:var(--sub);cursor:pointer">ğŸ“Š å€‹è‚¡æ˜ç´°</summary><div style="overflow-x:auto;margin-top:6px"><table style="width:100%;border-collapse:collapse;font-size:11px"><tr style="border-bottom:1px solid rgba(255,215,0,.1)"><th style="padding:3px 6px;color:var(--sub2);text-align:left">è‚¡ç¥¨</th><th style="padding:3px;text-align:center;color:var(--sub2)">é‡</th><th style="padding:3px;text-align:center;color:var(--sub2)">æˆæœ¬</th><th style="padding:3px;text-align:center;color:var(--sub2)">æœˆåº•</th><th style="padding:3px;text-align:right;color:var(--sub2)">æç›Š</th><th style="padding:3px;text-align:right;color:var(--sub2)">%</th></tr>`;
      r.sd.forEach(s=>{const ps=s.pnl>=0;h+=`<tr style="border-bottom:1px solid rgba(255,215,0,.03)"><td style="padding:2px 6px;color:var(--sub3)">${s.nm}</td><td class="mono" style="text-align:center;color:var(--cyan)">${s.sh}${s.ut||'å¼µ'}</td><td class="mono" style="text-align:center;color:var(--sub2)">${s.c}</td><td class="mono" style="text-align:center">${s.ep||'â€”'}</td><td class="mono bold" style="text-align:right;color:${ps?'var(--green)':'var(--red)'}">${fN(s.pnl)}</td><td class="mono bold" style="text-align:right;color:${ps?'var(--green)':'var(--red)'}">${ps?'+':''}${s.pct}%</td></tr>`});h+=`</table></div></details>`}
    if(r.memo)h+=`<p class="f11" style="color:var(--sub3);padding:6px 8px;background:rgba(100,255,218,.03);border-radius:4px">ğŸ’­ ${esc(r.memo)}</p>`;
    h+=`<div id="ex_${r.id}" style="display:none;margin-top:8px"></div></div>`;
  });
  h+=`</div>`;c.innerHTML=h;
}
function sSF(){const a=document.getElementById('sfA');if(a.innerHTML){a.innerHTML='';return}
  const act=D.holdings.filter(x=>!x.sold),mos=['2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ','8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ','1æœˆ','2æœˆ(2027)'];
  let h=`<div class="card" style="padding:14px;border-color:rgba(255,215,0,.2);margin-bottom:14px"><h3 class="f14 bold" style="color:var(--gold);margin-bottom:10px">ğŸ“Š æœˆçµç®—ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰</h3>
  <div style="margin-bottom:10px"><label class="f11" style="color:var(--sub)">æœˆä»½</label><select class="inp" id="sfm"><option value="">é¸æ“‡</option>${mos.map(m=>`<option>${m}</option>`).join('')}</select></div>
  <h4 class="f12" style="color:var(--gold);margin-bottom:6px">æœˆåº•æŒè‚¡ç¾åƒ¹</h4><div style="overflow-x:auto;margin-bottom:8px"><table style="width:100%;border-collapse:collapse;font-size:12px"><tr style="border-bottom:1px solid rgba(255,215,0,.1)"><th style="padding:4px 6px;color:var(--sub);text-align:left">è‚¡ç¥¨</th><th style="padding:4px;text-align:center;color:var(--sub)">é‡</th><th style="padding:4px;text-align:center;color:var(--sub)">æˆæœ¬</th><th style="padding:4px;text-align:left;color:var(--sub)">æœˆåº•åƒ¹</th><th style="padding:4px;text-align:right;color:var(--sub)">æç›Š</th><th style="padding:4px;text-align:right;color:var(--sub)">%</th></tr>`;
  act.forEach((s,i)=>h+=`<tr style="border-bottom:1px solid rgba(255,215,0,.04)"><td style="padding:4px 6px;font-weight:600">${s.name}<span class="f10" style="color:var(--sub2);margin-left:3px">${s.code}</span></td><td class="mono f11" style="text-align:center;color:var(--cyan)">${s.shares}${s.unit}</td><td class="mono f11" style="text-align:center;color:var(--sub3)">${s.cost}</td><td style="padding:3px 2px"><input class="inp" id="sh${i}" type="number" step="0.1" style="width:80px;padding:3px 6px;font-size:11px" oninput="cSF()"></td><td class="mono bold f11" style="text-align:right" id="shp${i}">â€”</td><td class="mono bold f11" style="text-align:right" id="shc${i}">â€”</td></tr>`);
  h+=`</table></div><div id="sSm" style="padding:10px 14px;border-radius:10px;background:linear-gradient(135deg,rgba(255,215,0,.06),rgba(100,255,218,.04));border:1px solid rgba(255,215,0,.15);margin-bottom:10px"><span class="f12" style="color:var(--sub)">è¼¸å…¥æœˆåº•åƒ¹å¾Œè‡ªå‹•è¨ˆç®—</span></div>
  <div class="grid2" style="margin-bottom:10px"><div><label class="f11" style="color:var(--sub)">ğŸ’µé…æ¯</label><input class="inp" id="sdv" value="0"></div><div><label class="f11" style="color:var(--sub)">ğŸ”„äº¤æ˜“æ¬¡æ•¸</label><input class="inp" id="str" value="0"></div></div>
  <div style="margin-bottom:10px"><label class="f11" style="color:var(--sub)">â­ è‡ªè©•ç­‰ç´š</label><div class="flex gap6" style="margin-top:4px">${GI.map(g=>`<button class="btn" id="sg_${g.g}" onclick="pG('${g.g}')" style="padding:5px 14px;font-size:13px;font-weight:700;color:var(--sub);border-color:var(--border2)">${g.g}</button>`).join('')}</div>
  <div style="margin-top:8px;padding:8px 10px;border-radius:8px;background:rgba(100,255,218,.03);border:1px solid rgba(100,255,218,.06)">${GI.map(g=>`<div class="flex gap6" style="margin-bottom:3px"><span style="color:${g.c};font-weight:900;min-width:16px;font-size:12px">${g.g}</span><span class="f11" style="color:var(--sub3)">${g.d}</span></div>`).join('')}</div></div>
  <div style="margin-bottom:12px"><textarea class="inp" id="sme" rows="3" placeholder="æœ¬æœˆå¿ƒå¾— / çµ¦Claudeçš„è©±"></textarea></div>
  <div class="flex gap8"><button class="btn btn-g" style="flex:1" onclick="savSF()">ğŸ’¾ å„²å­˜çµç®—</button><button class="btn btn-d" onclick="document.getElementById('sfA').innerHTML=''">å–æ¶ˆ</button></div></div>`;
  a.innerHTML=h;
}
function cSF(){const act=D.holdings.filter(x=>!x.sold);let tv=0,tc=0,all=true,bst={n:'',p:-Infinity},wst={n:'',p:Infinity};
  act.forEach((s,i)=>{const p=parseFloat(document.getElementById('sh'+i)?.value);const m=mul(s);tc+=s.cost*m;
    if(p&&!isNaN(p)){tv+=p*m;const pnl=Math.round((p-s.cost)*m),pct=((p-s.cost)/s.cost*100).toFixed(1),pos=pnl>=0,cl=pos?'var(--green)':'var(--red)';
      document.getElementById('shp'+i).innerHTML=`<span style="color:${cl}">${fN(pnl)}</span>`;
      document.getElementById('shc'+i).innerHTML=`<span style="color:${cl}">${pos?'+':''}${pct}%</span>`;
      const lb=s.name+(s.shares>1?'Ã—'+s.shares:''),pn=parseFloat(pct);if(pn>bst.p)bst={n:lb,p:pn};if(pn<wst.p)wst={n:lb,p:pn}}
    else{all=false;document.getElementById('shp'+i).textContent='â€”';document.getElementById('shc'+i).textContent='â€”'}});
  const sm=document.getElementById('sSm');const rz=D.pt.reduce((s,r)=>s+(r.pnl||0),0);
  if(all){const pnl=Math.round(tv-tc),pct=((tv-tc)/tc*100).toFixed(1),pos=pnl>=0,cl=pos?'var(--green)':'var(--red)';
    sm.innerHTML=`<div class="flex between wrap gap8" style="margin-bottom:6px"><div><span class="f10" style="color:var(--sub)">æœˆåº•å¸‚å€¼</span><p class="mono bold f14" style="color:var(--cyan)">$${tv.toLocaleString()}</p></div><div><span class="f10" style="color:var(--sub)">æœªå¯¦ç¾æç›Š</span><p class="mono bold f14" style="color:${cl}">${fN(pnl)}</p></div><div><span class="f10" style="color:var(--sub)">å ±é…¬ç‡</span><p class="mono bold f14" style="color:${cl}">${pos?'+':''}${pct}%</p></div>${rz?`<div><span class="f10" style="color:var(--sub)">å·²å¯¦ç¾</span><p class="mono bold f14" style="color:${rz>=0?'var(--green)':'var(--red)'}">${fN(rz)}</p></div>`:''}</div><div class="flex between wrap gap8"><div><span class="f10" style="color:var(--sub)">ğŸ†æœ€ä½³</span><p class="mono bold f12" style="color:var(--green)">${bst.n} ${bst.p>=0?'+':''}${bst.p.toFixed(1)}%</p></div><div><span class="f10" style="color:var(--sub)">ğŸ“‰æœ€å·®</span><p class="mono bold f12" style="color:var(--red)">${wst.n} ${wst.p>=0?'+':''}${wst.p.toFixed(1)}%</p></div></div>`}
  else sm.innerHTML=`<span class="f12" style="color:var(--sub)">è¼¸å…¥æ‰€æœ‰æœˆåº•åƒ¹å¾Œè‡ªå‹•è¨ˆç®—</span>`}
function pG(g){_gr=g;GI.forEach(x=>{const el=document.getElementById('sg_'+x.g);if(x.g===g){el.style.background=x.c+'30';el.style.borderColor=x.c;el.style.color=x.c}else{el.style.background='transparent';el.style.borderColor='rgba(100,255,218,.15)';el.style.color='var(--sub)'}})}
function savSF(){const act=D.holdings.filter(x=>!x.sold);let tv=0,tc=0,bst={n:'',p:-Infinity},wst={n:'',p:Infinity};
  const sd=act.map((s,i)=>{const p=parseFloat(document.getElementById('sh'+i)?.value)||0;const m=mul(s);tc+=s.cost*m;tv+=p*m;const pnl=Math.round((p-s.cost)*m),pct=((p-s.cost)/s.cost*100).toFixed(1),lb=s.name+(s.shares>1?'Ã—'+s.shares:''),pn=parseFloat(pct);if(pn>bst.p)bst={n:lb,p:pn};if(pn<wst.p)wst={n:lb,p:pn};return{cd:s.code,nm:s.name,sh:s.shares,ut:s.unit,c:s.cost,ep:p,pnl,pct}});
  const pnl=Math.round(tv-tc),pct=tc?((tv-tc)/tc*100).toFixed(1):'0',pos=pnl>=0,rz=D.pt.reduce((s,r)=>s+(r.pnl||0),0);
  D.ms.push({id:'ms_'+Date.now(),mo:document.getElementById('sfm').value,ev:'$'+tv.toLocaleString(),pa:fN(pnl),pp:(parseFloat(pct)>=0?'+':'')+pct+'%',bs:bst.n+' '+(bst.p>=0?'+':'')+bst.p.toFixed(1)+'%',ws:wst.n+' '+(wst.p>=0?'+':'')+wst.p.toFixed(1)+'%',dv:document.getElementById('sdv').value,tr:document.getElementById('str').value,gr:_gr,memo:document.getElementById('sme').value,sd,rp:rz?fN(rz):''});
  _gr='';sv();render();toast('âœ… çµç®—å·²å„²å­˜');
}
function exS(id){const r=D.ms.find(x=>x.id===id);if(!r)return;const el=document.getElementById('ex_'+id);if(el.style.display==='block'){el.style.display='none';return}
  let t=`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“Š å°è‚¡ä½œæˆ°è¨ˆç•« â€” ${r.mo}çµç®—å ±è¡¨\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\næŒè‚¡äººï¼šSone Wangï½œè‡ªè©•ï¼š${r.gr||'æœªè©•'}\n\nã€ğŸ“ˆ ç¸¾æ•ˆã€‘å¸‚å€¼:${r.ev} æç›Š:${r.pa} å ±é…¬:${r.pp} é…æ¯:${r.dv||0} äº¤æ˜“:${r.tr||0}æ¬¡\næœ€ä½³:${r.bs} æœ€å·®:${r.ws}\n${r.rp?'ç´¯è¨ˆå·²å¯¦ç¾:'+r.rp+'\n':''}\nã€ğŸ’¼ å€‹è‚¡ã€‘\n`;
  if(r.sd)r.sd.forEach(s=>{const ps=s.pnl>=0;t+=`${s.nm}(${s.cd}) ${s.sh}${s.ut||'å¼µ'} æˆæœ¬$${s.c} æœˆåº•$${s.ep} ${ps?'+':''}${s.pnl.toLocaleString()}(${ps?'+':''}${s.pct}%)\n`});
  if(D.pt.length){t+=`\nã€ğŸ’ äº†çµã€‘\n`;D.pt.forEach(p=>t+=`${p.dt} ${p.nm} ${p.qty}${p.ut} @${p.sp} ${fN(p.pnl)}\n`)}
  t+=`\nã€ğŸ’­ å¿ƒå¾—ã€‘${r.memo||'ç„¡'}\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâš ï¸ è«‹Claudeè©•æ ¸ï¼š1.ç¸¾æ•ˆè©•åˆ† 2.ç´€å¾‹è©•åƒ¹ 3.ä¸‹æœˆå»ºè­° 4.é¢¨éšªæé†’\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
  el.style.display='block';el.innerHTML=`<div style="padding:10px;border-radius:8px;background:rgba(255,215,0,.05);border:1px solid rgba(255,215,0,.15)"><div class="flex between center" style="margin-bottom:6px"><span class="f12 bold" style="color:var(--gold)">ğŸ“¤ åŒ¯å‡ºå ±è¡¨</span><button class="btn btn-p" onclick="navigator.clipboard.writeText(document.getElementById('et_${id}').value).then(()=>toast('ğŸ“‹ å·²è¤‡è£½ï¼è²¼çµ¦Claudeè©•æ ¸'))">ğŸ“‹ è¤‡è£½</button></div><textarea id="et_${id}" class="inp" rows="10" style="font-size:10px;line-height:1.5;background:rgba(0,0,0,.3)">${esc(t)}</textarea><p class="f11" style="color:var(--sub);margin-top:4px">è¤‡è£½å¾Œè²¼åˆ° Claude å°è©±å³å¯è©•æ ¸ ğŸ‘†</p></div>`}

// === HALF YEAR ===
function rHalf(c){
  let h=`<div class="fade"><h2 class="f16 bold" style="margin-bottom:4px">ğŸ“Š åŠå¹´åº¦çµç®—</h2><p class="f12" style="color:var(--sub);margin-bottom:14px">H1:2-7æœˆ H2:8-1æœˆï½œè‡ªå‹•å½™æ•´æœˆçµç®—</p>`;
  [1,2].forEach(hf=>{
    const lb=hf===1?'H1 ä¸ŠåŠå¹´ï¼ˆ2ï½7æœˆï¼‰':'H2 ä¸‹åŠå¹´ï¼ˆ8ï½éš”å¹´2æœˆï¼‰',cl=hf===1?'var(--gold)':'var(--purple)';
    const hm=hf===1?['2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ']:['8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ','1æœˆ','2æœˆ(2027)'];
    const st=D.ms.filter(s=>hm.includes(s.mo)),rz=D.pt.reduce((s,r)=>s+(r.pnl||0),0);
    const mt=MO.filter(m=>m.h===hf);let td=0,tt=0;mt.forEach(m=>{const p=mProg(m);td+=p.d;tt+=p.t});
    h+=`<div class="card" style="border-color:${hf===1?'rgba(255,215,0,.15)':'rgba(187,134,252,.15)'}"><div class="card-head" style="background:${hf===1?'rgba(255,215,0,.06)':'rgba(187,134,252,.06)'}"><h3 style="color:${cl}">${lb}</h3></div><div style="padding:14px 16px">`;
    if(!st.length)h+=`<p class="f13" style="color:var(--sub4)">å®Œæˆæœˆçµç®—å¾Œè‡ªå‹•å½™æ•´ã€‚</p>`;
    else{const ls=st[st.length-1];
      h+=`<div class="gridf" style="gap:8px;margin-bottom:12px">${[['æœˆçµç®—',st.length+'ç­†'],['æœ€æ–°å¸‚å€¼',ls.ev],['æœ€æ–°å ±é…¬',ls.pp,1],['ä»»å‹™',td+'/'+tt+' ('+Math.round(td/tt*100)+'%)']].map(([l,v,hl])=>`<div style="padding:8px 10px;border-radius:8px;background:rgba(100,255,218,.04)"><p class="f10" style="color:var(--sub2)">${l}</p><p class="mono bold f13" style="color:${hl?(String(v).startsWith('-')?'var(--red)':'var(--green)'):'var(--cyan)'}">${v}</p></div>`).join('')}${rz?`<div style="padding:8px 10px;border-radius:8px;background:${rz>=0?'rgba(0,230,118,.06)':'rgba(255,82,82,.06)'}"><p class="f10" style="color:var(--sub2)">å·²å¯¦ç¾</p><p class="mono bold f13" style="color:${rz>=0?'var(--green)':'var(--red)'}">${fN(rz)}</p></div>`:''}</div>
      <h4 class="f12" style="color:var(--sub3);margin-bottom:6px">æœˆåº¦è¶¨å‹¢</h4><div style="overflow-x:auto"><table style="width:100%;border-collapse:collapse;font-size:11px"><tr style="border-bottom:1px solid var(--border)"><th style="padding:4px 8px;color:var(--sub2);text-align:left">æœˆ</th><th style="padding:4px;text-align:center;color:var(--sub2)">ç­‰ç´š</th><th style="padding:4px;text-align:right;color:var(--sub2)">å¸‚å€¼</th><th style="padding:4px;text-align:right;color:var(--sub2)">æç›Š</th><th style="padding:4px;text-align:right;color:var(--sub2)">å ±é…¬</th></tr>`;
      const gc={S:'#ffd700',A:'#00e676',B:'#64ffda',C:'#ff8c00',D:'#e74c3c'};
      st.forEach(s=>h+=`<tr style="border-bottom:1px solid rgba(100,255,218,.03)"><td style="padding:3px 8px">${s.mo}</td><td style="text-align:center;font-weight:900;color:${gc[s.gr]||'var(--sub)'}">${s.gr||'-'}</td><td class="mono" style="text-align:right;color:var(--cyan)">${s.ev||''}</td><td class="mono bold" style="text-align:right;color:${String(s.pa||'').startsWith('-')?'var(--red)':'var(--green)'}">${s.pa||''}</td><td class="mono bold" style="text-align:right;color:${String(s.pp||'').startsWith('-')?'var(--red)':'var(--green)'}">${s.pp||''}</td></tr>`);
      h+=`</table></div>`}
    h+=`<div style="margin-top:10px"><button class="btn ${hf===1?'btn-g':'btn-v'}" onclick="exH(${hf})">ğŸ“¤ åŒ¯å‡º${hf===1?'H1':'H2'}å ±è¡¨</button></div><div id="he${hf}" style="display:none;margin-top:8px"></div></div></div>`;
  });h+=`</div>`;c.innerHTML=h;
}
function exH(hf){const el=document.getElementById('he'+hf);if(el.style.display==='block'){el.style.display='none';return}
  const lb=hf===1?'H1 ä¸ŠåŠå¹´':'H2 ä¸‹åŠå¹´',hm=hf===1?['2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ']:['8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ','1æœˆ','2æœˆ(2027)'];
  const st=D.ms.filter(s=>hm.includes(s.mo)),rz=D.pt.reduce((s,r)=>s+(r.pnl||0),0);
  const mt=MO.filter(m=>m.h===hf);let td=0,tt=0;mt.forEach(m=>{const p=mProg(m);td+=p.d;tt+=p.t});
  let t=`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“Š å°è‚¡ä½œæˆ°è¨ˆç•« â€” ${lb}çµç®—\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\næŒè‚¡äººï¼šSone Wang\n\nã€ğŸ“… æœˆåº¦è¶¨å‹¢ã€‘\n`;
  st.forEach(s=>t+=`${s.mo} [${s.gr||'-'}] å¸‚å€¼${s.ev} æç›Š${s.pa} å ±é…¬${s.pp}\n`);
  t+=`\nä»»å‹™å®Œæˆï¼š${td}/${tt} (${tt?Math.round(td/tt*100):0}%)\n`;
  if(rz)t+=`ç´¯è¨ˆå·²å¯¦ç¾ï¼š${fN(rz)}\n`;
  if(D.pt.length){t+=`\nã€ğŸ’ äº†çµã€‘\n`;D.pt.forEach(p=>t+=`${p.dt} ${p.nm} ${p.qty}${p.ut} @${p.sp} ${fN(p.pnl)} ${p.memo||''}\n`)}
  t+=`\nã€ğŸ’¼ ç¾æŒè‚¡ã€‘\n`;D.holdings.filter(x=>!x.sold).forEach(s=>t+=`${s.name}(${s.code}) ${s.shares}${s.unit} $${s.cost} ç›®æ¨™$${s.target} ${s.strat}\n`);
  t+=`\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâš ï¸ è«‹ClaudeåŠå¹´åº¦è©•æ ¸ï¼š1.æ•´é«”è©•åˆ† 2.çµ„åˆå»ºè­° 3.ä¸‹åŠå¹´ç­–ç•¥ 4.é¢¨éšªè­¦ç¤º\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
  el.style.display='block';el.innerHTML=`<div style="padding:10px;border-radius:8px;background:${hf===1?'rgba(255,215,0,.05)':'rgba(187,134,252,.05)'};border:1px solid ${hf===1?'rgba(255,215,0,.15)':'rgba(187,134,252,.15)'}"><div class="flex between center" style="margin-bottom:6px"><span class="f12 bold" style="color:${hf===1?'var(--gold)':'var(--purple)'}">${lb}å ±è¡¨</span><button class="btn btn-p" onclick="navigator.clipboard.writeText(document.getElementById('ht${hf}').value).then(()=>toast('ğŸ“‹ å·²è¤‡è£½ï¼'))">ğŸ“‹ è¤‡è£½</button></div><textarea id="ht${hf}" class="inp" rows="12" style="font-size:10px;line-height:1.5;background:rgba(0,0,0,.3)">${esc(t)}</textarea></div>`}

// === TARGETS ===
function rTarg(c){const act=D.holdings.filter(x=>!x.sold);let tp=0;
  let h=`<div class="fade"><h2 class="f16 bold" style="margin-bottom:14px">ğŸ¯ ç›®æ¨™èˆ‡æ½›åœ¨å ±é…¬</h2>`;
  act.forEach((s,i)=>{const tgt=parseFloat(s.target),m=mul(s),pot=tgt?Math.round((tgt-s.cost)*m):0;if(pot)tp+=pot;
    h+=`<div class="flex gap10 center wrap" style="padding:10px 14px;margin-bottom:5px;border-radius:8px;border:1px solid var(--border);background:${i%2===0?'var(--card)':'var(--card2)'}"><div style="min-width:90px"><p class="f13 bold">${s.name}${s.shares>1?'Ã—'+s.shares:''}</p><p class="f10" style="color:var(--sub2)">${s.code}ï½œ${s.strat||''}</p></div><div class="flex center gap6" style="flex:1"><span class="mono f12" style="color:var(--sub3)">${s.cost}</span><span style="color:var(--sub2)">â†’</span><span class="mono bold f12" style="color:var(--cyan)">${s.target||'â€”'}</span></div>${pot?`<p class="mono bold f13" style="color:${pot>=0?'var(--green)':'var(--red)'}">${fN(pot)}</p>`:''}</div>`});
  if(tp)h+=`<div style="margin-top:14px;padding:14px;border-radius:10px;text-align:center;background:linear-gradient(135deg,rgba(0,230,118,.08),rgba(100,255,218,.04));border:1px solid rgba(0,230,118,.15)"><p class="f12" style="color:var(--sub)">å…¨é”æ¨™æ½›åœ¨ç²åˆ©</p><p class="mono" style="font-size:24px;font-weight:900;color:var(--green)">${fN(tp)}</p></div>`;
  h+=`<div style="margin-top:16px;padding:14px;border-radius:10px;text-align:center;background:var(--card);border:1px solid var(--border)"><p class="bold f13" style="color:var(--cyan);margin-bottom:6px">ğŸ§§ å¿ƒæ³•</p><p class="f12" style="color:var(--sub3);line-height:2">ã€Œä¸å‹•å°±æ˜¯æœ€å¥½çš„å‹•ä½œã€‚ã€<br>ã€Œç”¨è³ºåˆ°çš„éŒ¢é–‹æ–°å€‰ã€‚ã€<br>ã€Œç´€å¾‹ > å ±é…¬ã€‚ã€</p></div></div>`;
  c.innerHTML=h;
}

ld();render();
</script>
</body>
</html>
